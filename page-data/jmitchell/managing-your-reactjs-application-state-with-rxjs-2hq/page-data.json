{"componentChunkName":"component---src-templates-blog-post-js","path":"/jmitchell/managing-your-reactjs-application-state-with-rxjs-2hq","result":{"data":{"site":{"siteMetadata":{"title":"JS.dev Community üë®üèº‚ÄçüíªüöÄüéì"}},"allMarkdownRemark":{"nodes":[{"id":"4b8bab91-5b4d-507f-9b8a-631b132fae0f","timeToRead":8,"fields":{"slug":"/jmitchell/managing-your-reactjs-application-state-with-rxjs-2hq"},"html":"<p><em>Do we need state management libraries?</em></p>\n<p>Managing application state is one of the hardest parts of writing an application. It‚Äôs often the first created component of any application, but tends to suffer from application growth. How exactly do you plan for managing application state in a huge code base, when you made decisions early on.</p>\n<p>When it comes to state manage in <a href=\"https://github.com/facebook/react\">React</a> applications, there‚Äôs a seemingly never ending discussion on the right approach. Do we go with <a href=\"https://github.com/reduxjs/redux\">Redux</a>, work with the boilerplate code and embrace the additional complexity, consider <a href=\"https://github.com/mobxjs/mobx\">MobX</a> but shift to an imperative approach using an object-oriented pattern. Or do we stick with React and use the in-built functions, like hooks and Context API to manage our state.</p>\n<p>Both approaches suffer when your application grows, and neither are interchangeable, given their contrasting approaches. This is when React state hooks and the Context API are introduced, and as advocates will tell you, it‚Äôs just easier to handle state using React.</p>\n<p>There are plenty of alternatives to using redux, but none really address the core issue of state management; how do you manage application state as the application grows? One of the reasons why Redux has been so popular, is because it solves the problem of prop drilling, that intricately links components through dependencies of data.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c9302fdc2b50f516ac842a14badb5071/5a190/nodes.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA50lEQVQoz3VTWQqFMAzs/Y/mARRcUNQfRdxwxSWPCS9SNQ6EljiZTNNq6I/zPG/rsizUNA21bUv7vnNeQoPkjZYURFFEnue9itEAzYZhoK7raNu2q948O+MjiHCW5zmVZcn7vu85hAveOI60ruvtdObpDt3TNKW6rq8chOI45jHYQGPwX0e2HYLkOA7N83wVwo3ruuxGgD2cC080jD03OKmqimOaJnWudnNwVIfHcVAYhlQUBQVBwIK+779EbDGsuJhPwSRJ2GGWZXxzmKNdrAnC4fO5ma939fWUvsYgMJoDzY32A2icHxxMEWXc936DAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Drilling props through components\"\n        title=\"Drilling props through components\"\n        src=\"/static/c9302fdc2b50f516ac842a14badb5071/fcda8/nodes.png\"\n        srcset=\"/static/c9302fdc2b50f516ac842a14badb5071/12f09/nodes.png 148w,\n/static/c9302fdc2b50f516ac842a14badb5071/e4a3f/nodes.png 295w,\n/static/c9302fdc2b50f516ac842a14badb5071/fcda8/nodes.png 590w,\n/static/c9302fdc2b50f516ac842a14badb5071/5a190/nodes.png 800w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The issue with redux-like libraries is that components and data are inexorably linked; components are dependent on redux and cannot take updates from the redux stores, without being redux components. This tight coupling is a choice that <em>has</em> to be made at the start of the project. Libraries like MobX are more flexible in their approach, but you still have the issue of state-to-component coupling, it‚Äôs unavoidable.</p>\n<h3 id=\"what-about-using-react-to-manage-our-state\" style=\"position:relative;\"><a href=\"#what-about-using-react-to-manage-our-state\" aria-label=\"what about using react to manage our state permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What about using React to manage our state?</h3>\n<p>Utilising the Context API allows us to pull in state as we need it, perform necessary operations and then commit our changes. Any components that depend on that context, with that data scope, will automatically receive the updates. Sounds great right? Well, here‚Äôs the kicker. Context API can be used to manage application state, but how do you manage the scope? It typically ends up being prop-drilling shifted elsewhere, more often than not, in the Contexts.</p>\n<p>That‚Äôs not to say you shouldn‚Äôt use the Context API to manage application state, quite the opposite. You <em>should</em> use it to <em>help</em> manage application state, but as a means to inject application state where it‚Äôs required. Using Context API to specifically <em>manage</em> your application state, is marginally better than prop drilling. At some point, somewhere in your application, contexts can and often do, get linked.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5511dd082bcc8a219eef89502edf6ede/5a190/context-nodes.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVQoz31SPVODQBDl71vY2KljY2uVKoWFY2WRBodA0CRj0HEI5u5CgFwC3O2TjyRCYNyZ+9i9eW/37a2Bwp7ZIy7ml5jRtHShNIF0Cmbfgo2vQUpWcSJqnUdr+sbQjfBgC5gvAqN7H76TnB6ncw9v048DqAYS6crPogXixQBp6J5Iy2W8B1vYQYLgW+LLXCNmCtAc3LkDnw3A50MI5wZ669VArWoVMsDae0IaeW1CdIzgTsbY8M8CVVSrYkTcw8R+RZ6rlkQp91V7mjFDFxd9YC9jYRjCNAuw+uuLKlR+LDxkWVYlLG0vxmDWFeTP6ECo6wqbDZVSYrlcQgiBJEkaman1AZVHCvGGI8/2XclKKViWBd/34bouVqsVHMdp/epxNeWlaQ59LrnctNZgjGG324FzXlVanr2EndGhk4qO5D7rm7nzRJ0KmxWcy/tvkPsIfwE2vghSGgKgzAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Context API still suffers from prop drilling\"\n        title=\"Context API still suffers from prop drilling\"\n        src=\"/static/5511dd082bcc8a219eef89502edf6ede/fcda8/context-nodes.png\"\n        srcset=\"/static/5511dd082bcc8a219eef89502edf6ede/12f09/context-nodes.png 148w,\n/static/5511dd082bcc8a219eef89502edf6ede/e4a3f/context-nodes.png 295w,\n/static/5511dd082bcc8a219eef89502edf6ede/fcda8/context-nodes.png 590w,\n/static/5511dd082bcc8a219eef89502edf6ede/5a190/context-nodes.png 800w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We can combine <code class=\"language-text\">useState</code> with the Context API, use deferred actions like <code class=\"language-text\">useEffect</code>, <code class=\"language-text\">useMemo</code> and other hook functions, or the equivalent functions with class components, to achieve a very-React way of doing things. But, how do we know what the state of our Context APIs are, or which ones we need to import, or which ones we need to update? How about asynchronous actions, race conditions, immutability? We don‚Äôt get a history of changes, unless we manage that ourselves.</p>\n<p>Context API and React hooks <em>don‚Äôt</em> solve this issue, which is what libraries like Redux attempted to solve in the first place. Which brings us full circle: React prop drilling (React) ‚Üí Redux/MobX (Lib) ‚Üí Context APIs and hooks (React).</p>\n<h3 id=\"why-use-redux-or-mobx\" style=\"position:relative;\"><a href=\"#why-use-redux-or-mobx\" aria-label=\"why use redux or mobx permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why use Redux or MobX?</h3>\n<p>One of the benefits that Redux brings is the approach to decouple of the state from the component. The side effect of that effort, is that state management is far more abstract than providing a simple API, or even using dereferencing (MobX) to directly interact with application state. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 553px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5330819c4274b6914dc67fd69e34bcee/a8a10/both.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.75675675675677%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAME/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABktHOtDSF/8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAAwQTIf/aAAgBAQABBQIs6GjIYspgTi0ncBTP/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Bh//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EAB0QAAIBBAMAAAAAAAAAAAAAAAABAgMREiExMnH/2gAIAQEABj8CutjjUH6aZlLg7H//xAAbEAACAwADAAAAAAAAAAAAAAABEQAhMVGBkf/aAAgBAQABPyEz3YDAcWmEIEtfSaLA/IqzhIGDNFvM/9oADAMBAAIAAwAAABCXL//EABcRAQEBAQAAAAAAAAAAAAAAAAEAETH/2gAIAQMBAT8QQdsW/8QAFhEBAQEAAAAAAAAAAAAAAAAAAREA/9oACAECAQE/EBUmIEu//8QAHRABAAMBAAIDAAAAAAAAAAAAAQARMSFBgZHh8P/aAAgBAQABPxA1V31CH3CBK4Q9RlmqqDBRzYiVLAvLnRP2TghxC55YPrWbW/E//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Why can&#39;t we have best of both worlds?\"\n        title=\"Why can&#39;t we have best of both worlds?\"\n        src=\"/static/5330819c4274b6914dc67fd69e34bcee/a8a10/both.jpg\"\n        srcset=\"/static/5330819c4274b6914dc67fd69e34bcee/a80bd/both.jpg 148w,\n/static/5330819c4274b6914dc67fd69e34bcee/1c91a/both.jpg 295w,\n/static/5330819c4274b6914dc67fd69e34bcee/a8a10/both.jpg 553w\"\n        sizes=\"(max-width: 553px) 100vw, 553px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>How often have you heard a developer say they would rather work with Redux, <a href=\"https://redux-saga.js.org/\">sagas</a>, <a href=\"https://redux-observable.js.org/docs/basics/Epics.html\">epics</a>, middlewares and actions, over a direct approach like MobX or the Context API? Dereferencing is the far more understandable approach, certainly for developers learning how to manage application state. You lose a lot of what Redux provides you, but you also do away with an extraordinary amount of boilerplate code and complexity.</p>\n<p>Demo time, let‚Äôs compare the pair!</p>\n<p>We‚Äôll create our context first, this is the same for all approaches except Redux which bundles its own Context provider:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Context API</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createContext<span class=\"token punctuation\">,</span> useContext <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"react\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> StateContext <span class=\"token operator\">=</span> <span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useStateContext</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>StateContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> StateProvider <span class=\"token operator\">=</span> StateContext<span class=\"token punctuation\">.</span>Provider<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Let‚Äôs use the Context API approach:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Foo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> foo <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useStateContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Foo<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>foo<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>StateProvider value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>foo<span class=\"token operator\">:</span> <span class=\"token string\">\"bar\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Foo <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>StateProvider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Let‚Äôs take a look at the approach with MobX:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// MobX</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> observer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mobx-react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> observable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mobx\"</span>\n\n<span class=\"token keyword\">const</span> Foo <span class=\"token operator\">=</span> <span class=\"token function\">observer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> foo <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useStateContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Foo<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>foo<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">observable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  foo<span class=\"token operator\">:</span> <span class=\"token string\">\"bar\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>StateProvider value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Foo <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>StateProvider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now let‚Äôs look at Redux (notice how we <em>don‚Äôt</em> use the Context that we‚Äôve created, <a href=\"https://react-redux.js.org/introduction/basic-tutorial\">follow the guide here</a>):</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Provider<span class=\"token punctuation\">,</span> connect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-redux\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createStore<span class=\"token punctuation\">,</span> combineReducers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"redux\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> initialState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token operator\">:</span> <span class=\"token string\">\"bar\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">combineReducers</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">state <span class=\"token operator\">=</span> initialState<span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token string\">\"SET_FOO\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> foo <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n            foo<span class=\"token operator\">:</span> foo\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n          <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Foo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>foo<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Foo<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>foo<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">mapStateToProps</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">state</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> foo <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> state<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> foo <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> ConnectedFoo <span class=\"token operator\">=</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>mapStateToProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>Foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Provider store<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>store<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>ConnectedFoo <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Provider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>It takes <em>3 times as much code</em> to integrate Redux with your application, and you <em>have</em> to dispatch mutation events to store changes.</p>\n<h3 id=\"is-rxjs-a-viable-option\" style=\"position:relative;\"><a href=\"#is-rxjs-a-viable-option\" aria-label=\"is rxjs a viable option permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Is RxJS a viable option?</h3>\n<p>All of the above options are enough to make anyone‚Äôs head spin, which brings us to <a href=\"https://github.com/ReactiveX/rxjs\">RxJS</a>, and using the asynchronous tools to manage state.</p>\n<p>I‚Äôm not going to tell you that it‚Äôs easy, or that it‚Äôs a simpler approach to state management in React, because it isn‚Äôt. For the complexity it adds, the benefits you get are far more advantageous than some of the options above.</p>\n<p>Let‚Äôs have a look at <a href=\"https://github.com/jmitchell38488/react-rxjs-state-example\">the example application</a> that I‚Äôve created on GitHub and discuss some of the approaches taken towards managing state. </p>\n<p>In general, the example application covers:</p>\n<ul>\n<li>Immutability</li>\n<li>Historical state</li>\n<li>Querying</li>\n<li>Observing and responding to state changes</li>\n<li>Using reducers to dispatch state changes</li>\n</ul>\n<p>The state management is influenced by Redux and the ideas of stores; data is logically stored in data blocks, prefixed with a store name, eg. <code class=\"language-text\">&quot;TODOS&quot;</code>. You can fetch the state management object data at any time that you need through the Context API, and query the data in stores through the method <code class=\"language-text\">getStore()</code>. </p>\n<p>The API function <code class=\"language-text\">getStore</code> takes two inputs - the store name and the query path, a period-concatenated string of object literals, as well as an array filter function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Object querying</span>\n<span class=\"token function\">getStore</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TODOS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"items\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Array filtering</span>\n<span class=\"token function\">getStore</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TODOS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"items.completed#1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// returns [{}, ...]</span>\n\n<span class=\"token comment\">// completed#1 is transformed to: field[completed], value[1]</span></code></pre></div>\n<p>If no value is present on the query path, <code class=\"language-text\">undefined</code> is returned. If an array filter is passed, and no array exists, <code class=\"language-text\">undefined</code> is also returned. When you filter on an array, if the value is an object, it will attempt to match the key/value against the field/value pair for each entry, or if the array value is not an object, it will attempt to match the entry value against the query value.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> items <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> completed<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> completed<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> completed<span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">}</span>\n  <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">1</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">getStore</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TODO\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"items.completed#1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Process:</span>\nitems<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>val is object<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> val<span class=\"token punctuation\">[</span>field<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> value<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> val <span class=\"token operator\">===</span> value\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Expected items: 5</span></code></pre></div>\n<p>Unlike MobX where dereferencing data in an observing object provides obserable behaviour on mutation or assignment, like Redux, the user needs to fire off an update event. You create a reducer that responds to update events, and then update the state dependent on that call. Where RxJS shines is that an event is an arbitraty event, you can opt to send data with the event, so that observers can instantly consume the new state without querying the store:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span> item<span class=\"token punctuation\">,</span> setItem <span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Register</span>\n<span class=\"token function\">registerStoreReducer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TODOS\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>action <span class=\"token operator\">===</span> <span class=\"token string\">\"SET.ITEM\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Code to update store</span>\n    <span class=\"token function\">notifyObservers</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">,</span> <span class=\"token string\">\"UPDATE\"</span><span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">.</span><span class=\"token function\">getStore</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TODOS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Consume</span>\n<span class=\"token function\">subscribeOnStore</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TODOS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SET.ITEM\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Update</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">notifyObservers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TODOS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SET.ITEM\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> completed<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To load this approach into our application, we need to:</p>\n<ol>\n<li>Initialise our RxJS state container</li>\n<li>Create a store</li>\n<li>Register reducers</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token function\">initialiseState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">registerReducers</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nstate<span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TODOS.items\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>StateProvider value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>state<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>TodoList <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>StateProvider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>The benefit of this approach over Redux is that we leverage the flexibility Context API, to inject different streams of data whever we need it, while adding rich functionality on top of it, but <em>never</em> replacing it. </p>\n<p>Let‚Äôs say you have a user management state object on top of your todos. This isn‚Äôt something you want to risk leaking into your wider application, so you would want to separate the state. Using the RxJS approach above, you would initialise a new state container and provide that through the Context API.</p>\n<h3 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h3>\n<p>Like Redux, there is boilerplate code to get going, but the one thing we‚Äôre not doing with our code, is creating higher-order components to inject store data as props into our components. That approach is useful and often very helpful, but that should be a separate, opt-in approach.</p>\n<p>The benefit that you do get with RxJS is simplicity over complexity. It‚Äôs not as easy to use as the Context API or MobX, but you know through the naming conventions of the state utility functions, what happens where. Combining the observers with <code class=\"language-text\">useEffect</code> would be ideal, so that you can subscribe/unsubscribe as the data changes, but more importantly, unsubscribe from all store subscriptions when the component unloads.</p>\n<p>This sample application is not intended for production use; it‚Äôs a proof of concept to prove that an observable approach is possible, accessible and should be considered a viable alternative.</p>","excerpt":"Do we need state management libraries? Managing application state is one of the hardest parts of writing an application. It‚Äôs‚Ä¶","frontmatter":{"date":"October 04, 2020","publishedDate":"October 04, 2020","updatedDate":"October 04, 2020","published":true,"title":"Managing your ReactJS application state with RxJS","authors":["jmitchell"],"posttags":["javascript","tutorial","react","functional"],"hero":{"childImageSharp":{"fluid":{"src":"/static/a9b32635f2c4d92eabb5f853c1d4e85e/dd13c/hero.jpg"}}}}}]}},"pageContext":{"authors":["jmitchell"],"slug":"/jmitchell/managing-your-reactjs-application-state-with-rxjs-2hq","previous":{"id":"609a2f18-d13e-55a7-8cc0-a46091d975fa","fields":{"slug":"/jmitchell/how-to-get-started-writing-unit-tests-for-react-with-enzyme-and-jest-mfw"},"timeToRead":17,"frontmatter":{"date":"01 Oct, 2020","publishedDate":"03 Oct, 2020","updatedDate":null,"title":"How to get started writing unit tests for React with jest and enzyme","authors":["jmitchell"],"posttags":["javascript","tutorial","react","testing"],"uid":"1fbkfq6nmfw"}},"next":{"id":"6cc5c116-f76c-5521-bf2d-e2022534406c","fields":{"slug":"/jmitchell/code-coverage-testing-when-enough-is-enough-uqq"},"timeToRead":11,"frontmatter":{"date":"14 Feb, 2021","publishedDate":"14 Feb, 2021","updatedDate":"15 Feb, 2021","title":"Code coverage testing, when enough is enough","authors":["jmitchell"],"posttags":["javascript","webdev","testing","react"],"uid":"h4jkl4k2uqq"}}}},"staticQueryHashes":["1149526610","1635669961","2756842759","2837448543","3763906766"]}